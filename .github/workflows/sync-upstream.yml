name: Sync main branch to personal fork

on:
  # ì›ë³¸ ë ˆí¬(main)ì— ì»¤ë°‹/ë¨¸ì§€ë  ë•Œë§ˆë‹¤ ìë™ ì‹¤í–‰
  push:
    branches:
      - main

  # í•„ìš”í•  ë•Œ ìˆ˜ë™ìœ¼ë¡œë„ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

permissions:
  contents: read

jobs:
  sync-to-fork:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout organization repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Push main to personal fork
        env:
          # ğŸ‘‰ ì—¬ê¸° ì‹œí¬ë¦¿ì€ ì¡°ì§ ë ˆí¬ì˜ Settings > Secrets and variables > Actions ì—ì„œ
          #    ê°œì¸ ê³„ì • PAT( repo ê¶Œí•œ )ìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆ: PERSONAL_FORK_TOKEN
          PERSONAL_FORK_TOKEN: ${{ secrets.PERSONAL_FORK_TOKEN }}
          PERSONAL_EMAIL: ${{ secrets.PERSONAL_EMAIL }}
        run: |
          if [ -z "$PERSONAL_FORK_TOKEN" ]; then
            echo "âŒ PERSONAL_FORK_TOKEN ì‹œí¬ë¦¿ì´ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤."
            exit 1
          fi

          FORK_REPO_OWNER="dohy-eon"
          FORK_REPO_NAME="Valuedi_Web"

          # Git ì‚¬ìš©ìë¥¼ ê°œì¸ ê³„ì •ìœ¼ë¡œ ì„¤ì • (í† í° ì†Œìœ ìì™€ ì¼ì¹˜í•´ì•¼ í•¨)
          git config user.name "dohy-eon"
          git config user.email "${PERSONAL_EMAIL:-dohy-eon@users.noreply.github.com}"

          # ê¸°ì¡´ fork remoteê°€ ìˆìœ¼ë©´ ì œê±°
          git remote remove fork 2>/dev/null || true

          # í† í°ì„ ì‚¬ìš©í•˜ì—¬ remote ì¶”ê°€
          git remote add fork "https://x-access-token:${PERSONAL_FORK_TOKEN}@github.com/${FORK_REPO_OWNER}/${FORK_REPO_NAME}.git"

          # ìµœì‹  main ê¸°ì¤€ìœ¼ë¡œ í¬í¬ì˜ mainì„ ë®ì–´ì“°ê¸° (íˆìŠ¤í† ë¦¬ ìœ ì§€í•˜ë©´ì„œ fast-forward ë˜ëŠ” force-with-lease ê°€ëŠ¥)
          git push fork main:main


