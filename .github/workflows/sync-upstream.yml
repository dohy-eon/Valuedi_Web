name: Sync main branch to personal fork

on:
  # ì›ë³¸ ë ˆí¬(main)ì— ì»¤ë°‹/ë¨¸ì§€ë  ë•Œë§ˆë‹¤ ìë™ ì‹¤í–‰
  push:
    branches:
      - main

  # í•„ìš”í•  ë•Œ ìˆ˜ë™ìœ¼ë¡œë„ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

permissions:
  contents: read

jobs:
  sync-to-fork:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout organization repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configure Git user
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Push main to personal fork
        env:
          # ğŸ‘‰ ì—¬ê¸° ì‹œí¬ë¦¿ì€ ì¡°ì§ ë ˆí¬ì˜ Settings > Secrets and variables > Actions ì—ì„œ
          #    ê°œì¸ ê³„ì • PAT( repo ê¶Œí•œ )ìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆ: PERSONAL_FORK_TOKEN
          PERSONAL_FORK_TOKEN: ${{ secrets.PERSONAL_FORK_TOKEN }}
        run: |
          if [ -z "$PERSONAL_FORK_TOKEN" ]; then
            echo "âŒ PERSONAL_FORK_TOKEN ì‹œí¬ë¦¿ì´ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤."
            exit 1
          fi

          FORK_REPO_OWNER="dohy-eon"
          FORK_REPO_NAME="Valuedi_Web"

          git remote add fork "https://x-access-token:${PERSONAL_FORK_TOKEN}@github.com/${FORK_REPO_OWNER}/${FORK_REPO_NAME}.git"

          # ìµœì‹  main ê¸°ì¤€ìœ¼ë¡œ í¬í¬ì˜ mainì„ ë®ì–´ì“°ê¸° (íˆìŠ¤í† ë¦¬ ìœ ì§€í•˜ë©´ì„œ fast-forward ë˜ëŠ” force-with-lease ê°€ëŠ¥)
          git push fork main:main


